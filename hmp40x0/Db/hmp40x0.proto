# Protocol file for T&S HMP2000/HMP4000 power supplies

Terminator = LF;
#ReadTimeout = 200;

P = "CstatV-AC:";
DEV = "HMP4040";

get_err {
   out "syst:err?";
   in "%(" $P $DEV ":SystErr)#s";
   #@init {  out "syst:err?";
   #in "%(" $P $DEV ":SystErr)#s"; 
   #in "%#s";}
}

get_id {
   out "*idn?";
   in "%#s";
   @init { out "*idn?";
   	 in "%#s"; }
   @replytimeout { get_err; }
}

get_stat {
   out "stat:ques:inst:isum\$1?";
   in "%i";
   @replytimeout { get_err; }
}

get_set_val {
   out "INST OUT\$1";
   out "\$2?";
   in "%f";
   @replytimeout { get_err; }
}

get_meas_val {
   out "INST OUT\$1";
   out "MEAS:\$2?";
   #out "ME";
   in "%f";
   @replytimeout { get_err; }
}

set_val {
   out "INST OUT\$1";
   out "\$2 %.3f";
   out "syst:err?";
   in "0, \"No error\"";
   @init { out "INST OUT\$1";
           out "\$2?";
   	 in "%f"; }
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

set_active {
   out "INST OUT\$1";
   out "OUTP:SEL %i";
   out "OUTP %i";
   out "syst:err?";
   in "0, \"No error\"";
   @init { out "INST OUT\$1";
           out "OUTP?";
   	 in "%i"; }
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

get_active {
   out "INST OUT\$1";
   out "OUTP?";
   in "%i";
   @replytimeout { get_err; }
   @init { out "INST OUT\$1";
           out "OUTP?";
   	 in "%i"; }
}

set_syst {
   out "syst:\$1";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

get_esr {
   out "*esr?";
   in "%i";
   @replytimeout { get_err; }
   @init { out "*esr?";
   in "%i";}
}

set_com {
   out "*\$1";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

set_ese {
   out "*ese %i";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

set_sre {
   out "*sre %i";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

set_sav {
   out "*sav %i";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

set_rcl {
   out "*rcl %i";
   out "syst:err?";
   in "0, \"No error\"";
   @mismatch {in "%(" $P $DEV ":SystErr)#s";}
}

get_stb {
   out "*stb?";
   in "%i";
   @replytimeout { get_err; }
}

get_tst {
   out "*tst?";
   in "%i";
   @replytimeout { get_err; }
}


